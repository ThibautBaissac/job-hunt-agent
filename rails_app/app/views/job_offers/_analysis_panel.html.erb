<% presenter = local_assigns.fetch(:presenter) { JobOfferPresenter.new(job_offer) } %>
<section id="<%= dom_id(job_offer, :analysis) %>" class="space-y-4 rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
  <header class="space-y-2">
    <div class="flex items-center justify-between gap-3">
      <h2 class="text-lg font-semibold text-indigo-900">Résumé IA</h2>
      <span class="text-xs font-medium text-emerald-600"><%= presenter.analysis_status %></span>
    </div>
    <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold <%= presenter.analysis_backend_badge_classes %>">
      <%= presenter.analysis_backend_label %>
    </span>
  </header>

  <% if presenter.summary.present? %>
    <p class="text-sm leading-relaxed text-slate-700"><%= presenter.summary %></p>
  <% end %>

  <dl class="grid gap-4 sm:grid-cols-2 text-sm text-slate-600">
    <div class="space-y-1">
      <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Séniorité déduite</dt>
      <dd><%= job_offer.seniority_level.presence || "Non précisée" %></dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Dernière analyse</dt>
      <dd><%= job_offer.analyzed_at.present? ? l(job_offer.analyzed_at, format: :long) : "En attente" %></dd>
    </div>
  </dl>

  <% if presenter.tech_stack.any? %>
    <div class="space-y-2">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">Technologies détectées</h3>
      <ul class="flex flex-wrap gap-2">
        <% presenter.tech_stack.each do |tech| %>
          <li class="rounded-full bg-indigo-50 px-3 py-1 text-xs font-semibold text-indigo-800"><%= tech %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% if presenter.keywords.any? %>
    <div class="space-y-2">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">Mots-clés détectés</h3>
      <ul class="flex flex-wrap gap-2">
        <% presenter.keywords.each do |keyword| %>
          <li class="rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-800"><%= keyword %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= render "job_offers/analysis_backend_actions", job_offer: job_offer, presenter: presenter %>

  <div id="<%= dom_id(job_offer, :analysis_stream) %>" class="hidden"></div>
</section>
