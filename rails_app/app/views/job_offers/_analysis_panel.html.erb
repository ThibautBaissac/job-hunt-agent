<% presenter = local_assigns.fetch(:presenter) { JobOfferPresenter.new(job_offer) } %>
<section class="space-y-4 rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
  <header class="flex items-center justify-between">
    <h2 class="text-lg font-semibold text-indigo-900">Résumé IA</h2>
    <span class="text-xs font-medium text-emerald-600"><%= presenter.analysis_status %></span>
  </header>

  <% if presenter.summary.present? %>
    <p class="text-sm leading-relaxed text-slate-700"><%= presenter.summary %></p>
  <% end %>

  <dl class="grid gap-4 sm:grid-cols-2 text-sm text-slate-600">
    <div class="space-y-1">
      <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Séniorité déduite</dt>
      <dd><%= job_offer.seniority_level.presence || "Non précisée" %></dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Dernière analyse</dt>
      <dd><%= job_offer.analyzed_at.present? ? l(job_offer.analyzed_at, format: :long) : "En attente" %></dd>
    </div>
  </dl>

  <% if presenter.tech_stack.any? %>
    <div class="space-y-2">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">Technologies détectées</h3>
      <ul class="flex flex-wrap gap-2">
        <% presenter.tech_stack.each do |tech| %>
          <li class="rounded-full bg-indigo-50 px-3 py-1 text-xs font-semibold text-indigo-800"><%= tech %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% if presenter.keywords.any? %>
    <div class="space-y-2">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">Mots-clés détectés</h3>
      <ul class="flex flex-wrap gap-2">
        <% presenter.keywords.each do |keyword| %>
          <li class="rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-800"><%= keyword %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="flex flex-wrap items-center justify-end gap-3">
    <%= button_to "Relancer l'analyse",
          analyze_job_offer_path(job_offer),
          method: :post,
          class: "inline-flex items-center gap-2 rounded-md border border-indigo-200 px-3 py-1.5 text-xs font-semibold text-indigo-900 transition hover:bg-indigo-50",
          data: { turbo_stream: true } %>
  </div>

  <div id="<%= dom_id(job_offer, :analysis_stream) %>" class="hidden"></div>
</section>
